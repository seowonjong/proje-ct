<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.PreparedStatement"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    <%@include file="db.jsp" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>근무일수집계</title>
<style>
	*{
		margin: 0;
		padding: 0;
	}
	
	section{
		width: 100%;
		height: calc(100vh - 130px);
		background-color: lightgray;
	
	}

	section h2{
		padding: 20px;
		text-align: center;
	}
	section div{
		display: flex;
		justify-content: center;
	}
	table td{
		text-align: center;
	}

</style>
</head>
<body>
<jsp:include page="header.jsp"></jsp:include>
	<jsp:include page="nav.jsp"></jsp:include>
	<section>
		<h2> 부서별근무일수집계 </h2>
		<div>
			<table border="1">
				<tr>
					<td>사원번호</td>
					<td>이름</td>
					<td>부서명</td>
					<td>근무일수</td>
				</tr>
			
			<%
				PreparedStatement pstmt = null;
				ResultSet rs = null;
				String deptname = "";
				try{
					String sql = "select em.empno, em.empname, em.deptcode, count(re.resvdate) as countday " + 
							"from tbl_emp_2504 em, tbl_resv_2504 re " +
							"where em.empno = re.empno " +
							"group by em.empno, em.empname, em.deptcode " +
							"order by em.deptcode";
					pstmt = con.prepareStatement(sql);
					
					rs = pstmt.executeQuery();
					while(rs.next()){
						String deptcode = rs.getString("deptcode");
						switch(deptcode){
						case "10":
							deptname = "영업팀";
							break;
						case "20":
							deptname = "총무팀";
							break;
						case "30":
							deptname="구매팀";
							break;
						}
					%>
					<tr>
						<td><%=rs.getString(1) %></td>
					<td><%=rs.getString(2) %></td>
					<td><%=deptname %></td>
					<td><%=rs.getString(4) %></td>
					</tr>
					<% 
					}
					}catch(Exception e){
					e.printStackTrace();
				}
			
			%>
			</table>
		
		</div>
		
	</section>
	<jsp:include page="footer.jsp"></jsp:include>
</body>
</html>