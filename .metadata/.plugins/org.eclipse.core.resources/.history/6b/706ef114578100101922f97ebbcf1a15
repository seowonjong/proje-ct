<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.PreparedStatement"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@include file="db.jsp" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>근무일수집계</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Noto Sans KR', sans-serif;
    }

    body {
        background: #f7f7f7;
        color: #333;
    }

    section {
        width: 100%;
        min-height: calc(100vh - 130px);
        padding: 30px 0;
        background-color: #f7f7f7;
    }

    section h2 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 28px;
        font-weight: bold;
        color: #444;
    }

    section div {
        display: flex;
        justify-content: center;
    }

    table {
        border-collapse: collapse;
        width: 80%;
        background: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        overflow: hidden;
    }

    thead {
        background: linear-gradient(90deg, #ff9a9e, #fad0c4);
        color: white;
    }

    thead th {
        padding: 15px;
        font-size: 16px;
    }

    tbody td {
        text-align: center;
        padding: 12px;
        border-bottom: 1px solid #ddd;
        font-size: 15px;
    }

    tbody tr:hover {
        background-color: #f1f1f1;
        cursor: pointer;
    }

    /* Footer 고정 */
    footer {
        width: 100%;
        height: 40px;
        background-color: pink;
        text-align: center;
        line-height: 40px;
        position: fixed;
        bottom: 0;
        left: 0;
    }
</style>
</head>
<body>
    <jsp:include page="header.jsp"></jsp:include>
    <jsp:include page="nav.jsp"></jsp:include>

    <section>
        <h2>부서별 근무일수 집계</h2>
        <div>
            <table>
                <thead>
                    <tr>
                        <th>사원번호</th>
                        <th>이름</th>
                        <th>부서명</th>
                        <th>근무일수</th>
                    </tr>
                </thead>
                <tbody>
                <%
                    PreparedStatement pstmt = null;
                    ResultSet rs = null;
                    String deptname = "";
                    try {
                        String sql = "SELECT em.empno, em.empname, em.deptcode, COUNT(re.resvdate) AS countday " +
                                     "FROM tbl_emp_2504 em, tbl_resv_2504 re " +
                                     "WHERE em.empno = re.empno " +
                                     "GROUP BY em.empno, em.empname, em.deptcode " +
                                     "ORDER BY em.deptcode";
                        pstmt = con.prepareStatement(sql);
                        rs = pstmt.executeQuery();
                        while(rs.next()){
                            String deptcode = rs.getString("deptcode");
                            switch(deptcode){
                                case "10": deptname = "영업팀"; break;
                                case "20": deptname = "총무팀"; break;
                                case "30": deptname = "구매팀"; break;
                            }
                %>
                    <tr>
                        <td><%=rs.getString(1)%></td>
                        <td><%=rs.getString(2)%></td>
                        <td><%=deptname%></td>
                        <td><%=rs.getString(4)%></td>
                    </tr>
                <%
                        }
                    } catch(Exception e){
                        e.printStackTrace();
                    }
                %>
                </tbody>
            </table>
        </div>
    </section>

    <jsp:include page="footer.jsp"></jsp:include>
</body>
</html>
